<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>John Curtin’s Stats and Coding Notebook - 1&nbsp; Analysis of Repeated Measures in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./bayes.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./repeated_measures.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis of Repeated Measures in R</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">John Curtin’s Stats and Coding Notebook</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jjcurtin/docs_notes" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repeated_measures.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis of Repeated Measures in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bayesian Analyses with rstanarm</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancova_repeated_measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">ANCOVA vs.&nbsp;Difference Scores</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./research_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Research Design Topics</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up"><span class="header-section-number">1.1</span> Set up</a>
  <ul class="collapse">
  <li><a href="#load-packages-and-data" id="toc-load-packages-and-data" class="nav-link" data-scroll-target="#load-packages-and-data"><span class="header-section-number">1.1.1</span> Load packages and data</a></li>
  <li><a href="#read-and-format-data-in-long-format" id="toc-read-and-format-data-in-long-format" class="nav-link" data-scroll-target="#read-and-format-data-in-long-format"><span class="header-section-number">1.1.2</span> Read and format data in long format</a></li>
  <li><a href="#format-data-in-wide-format" id="toc-format-data-in-wide-format" class="nav-link" data-scroll-target="#format-data-in-wide-format"><span class="header-section-number">1.1.3</span> Format data in wide format</a></li>
  <li><a href="#setting-contrast-matrices-for-factors" id="toc-setting-contrast-matrices-for-factors" class="nav-link" data-scroll-target="#setting-contrast-matrices-for-factors"><span class="header-section-number">1.1.4</span> Setting contrast matrices for factors</a></li>
  </ul></li>
  <li><a href="#explore-two-level-repeated-measures" id="toc-explore-two-level-repeated-measures" class="nav-link" data-scroll-target="#explore-two-level-repeated-measures"><span class="header-section-number">1.2</span> Explore two level repeated measures</a>
  <ul class="collapse">
  <li><a href="#diff-score-approach" id="toc-diff-score-approach" class="nav-link" data-scroll-target="#diff-score-approach"><span class="header-section-number">1.2.1</span> diff score approach</a></li>
  <li><a href="#lmer-approach-with-time-as-manually-coded-regressor" id="toc-lmer-approach-with-time-as-manually-coded-regressor" class="nav-link" data-scroll-target="#lmer-approach-with-time-as-manually-coded-regressor"><span class="header-section-number">1.2.2</span> lmer approach with time as manually coded regressor</a></li>
  <li><a href="#lmer-approach-with-time-as-factor" id="toc-lmer-approach-with-time-as-factor" class="nav-link" data-scroll-target="#lmer-approach-with-time-as-factor"><span class="header-section-number">1.2.3</span> lmer approach with time as factor</a></li>
  <li><a href="#lmer-approach-with-by-subject-random-effect-of-time" id="toc-lmer-approach-with-by-subject-random-effect-of-time" class="nav-link" data-scroll-target="#lmer-approach-with-by-subject-random-effect-of-time"><span class="header-section-number">1.2.4</span> lmer approach with by-subject random effect of time</a></li>
  </ul></li>
  <li><a href="#explore-three-level-repeated-measures" id="toc-explore-three-level-repeated-measures" class="nav-link" data-scroll-target="#explore-three-level-repeated-measures"><span class="header-section-number">1.3</span> Explore three level repeated measures</a>
  <ul class="collapse">
  <li><a href="#using-afexaov_car" id="toc-using-afexaov_car" class="nav-link" data-scroll-target="#using-afexaov_car"><span class="header-section-number">1.3.1</span> Using <code>afex::aov_car</code></a></li>
  <li><a href="#diff-score-approach-1" id="toc-diff-score-approach-1" class="nav-link" data-scroll-target="#diff-score-approach-1"><span class="header-section-number">1.3.2</span> Diff score approach</a></li>
  <li><a href="#lmer-approach-with-time-as-factor-1" id="toc-lmer-approach-with-time-as-factor-1" class="nav-link" data-scroll-target="#lmer-approach-with-time-as-factor-1"><span class="header-section-number">1.3.3</span> lmer approach with time as factor</a></li>
  <li><a href="#lmer-approach-with-regressors-for-time" id="toc-lmer-approach-with-regressors-for-time" class="nav-link" data-scroll-target="#lmer-approach-with-regressors-for-time"><span class="header-section-number">1.3.4</span> lmer approach with regressors for time</a></li>
  <li><a href="#lmer-approach-with-regressors-for-time-and-separate-error-terms" id="toc-lmer-approach-with-regressors-for-time-and-separate-error-terms" class="nav-link" data-scroll-target="#lmer-approach-with-regressors-for-time-and-separate-error-terms"><span class="header-section-number">1.3.5</span> lmer approach with regressors for time AND separate error terms</a></li>
  <li><a href="#with-random-effect-for-time" id="toc-with-random-effect-for-time" class="nav-link" data-scroll-target="#with-random-effect-for-time"><span class="header-section-number">1.3.6</span> With random effect for time</a></li>
  <li><a href="#lmer-with-time-as-continuous-variable" id="toc-lmer-with-time-as-continuous-variable" class="nav-link" data-scroll-target="#lmer-with-time-as-continuous-variable"><span class="header-section-number">1.3.7</span> lmer with time as continuous variable</a></li>
  </ul></li>
  <li><a href="#predicted-values-and-figures" id="toc-predicted-values-and-figures" class="nav-link" data-scroll-target="#predicted-values-and-figures"><span class="header-section-number">2</span> Predicted values and figures</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jjcurtin/docs_notes/edit/main/repeated_measures.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analysis of Repeated Measures in R</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This is a long exploration of how to handle repeated measures in R. It focused primarily on <code>lm()</code> vs <code>lmer()</code> but also considers <code>aov_car()</code> from the afex package. It is limited to considering a single within subject variable with 2 or 3 levels but the conclusions generalize to models that also include between subject factors.</p>
<p>Conclusions:</p>
<ul>
<li><p>I prefer simple <code>lm()</code> with difference scores for 2 and 3 level time variable if I don’t need/want to test main effect (2df) of time (which is suspect anyway) and I do want 1df time contrasts. [If I really need the main effect test, use <code>aov_car()</code>].</p></li>
<li><p>HOWEVER, <code>aov_car()</code> should be considered. It gives same 1df contrasts (using <code>emmeans</code> package). It does give main effect of time with corrections for violations if desired and it allows you to keep data in long format! Not sure (not tested) if it could handle quantitiave between subject factors like lm() can.</p></li>
</ul>
<p><code>lmer()</code> with time as quantitative variable is preferred if I can focus on only the linear effect (assuming 3 levels) and particularly if I have missing data or timepoints that vary by participant. If I had more time points and could also get quad, this might be better than lm() too because simpler than the many contrast possible with 4 levels of time.</p>
<p>If I had psuedoreplications on time, I would prefer the <code>lmer()</code> approach with categorical time because we could then model the by subject random slope for time and not worry about the sphericity assumption and stay in long format, etc. If more levels (than 3) for time, I’d switch to lmer() with random slopes and quantitative time</p>
<section id="set-up" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="set-up"><span class="header-section-number">1.1</span> Set up</h2>
<section id="load-packages-and-data" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="load-packages-and-data"><span class="header-section-number">1.1.1</span> Load packages and data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="read-and-format-data-in-long-format" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="read-and-format-data-in-long-format"><span class="header-section-number">1.1.2</span> Read and format data in long format</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"repeated_measures.csv"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dyad <span class="sc">==</span> <span class="st">"Patient"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>dyad) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 99
Columns: 4
$ study_id &lt;dbl&gt; 600, 600, 600, 101, 101, 101, 102, 102, 102, 100, 100, 100, 1…
$ arm      &lt;chr&gt; "PartnerCHESS", "PartnerCHESS", "PartnerCHESS", "A-CHESS", "A…
$ time     &lt;dbl&gt; 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3…
$ hdd      &lt;dbl&gt; 65.0, 59.5, 42.0, 100.0, 100.0, 100.0, 0.0, 0.0, 0.0, 13.6, 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 99 × 4
   study_id arm           time   hdd
      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
 1      600 PartnerCHESS     1  65  
 2      600 PartnerCHESS     2  59.5
 3      600 PartnerCHESS     3  42  
 4      101 A-CHESS          1 100  
 5      101 A-CHESS          2 100  
 6      101 A-CHESS          3 100  
 7      102 PartnerCHESS     1   0  
 8      102 PartnerCHESS     2   0  
 9      102 PartnerCHESS     3   0  
10      100 PartnerCHESS     1  13.6
# ℹ 89 more rows</code></pre>
</div>
</div>
</section>
<section id="format-data-in-wide-format" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="format-data-in-wide-format"><span class="header-section-number">1.1.3</span> Format data in wide format</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(study_id, arm, time, hdd) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> hdd) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time1 =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">time2 =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">time3 =</span> <span class="st">`</span><span class="at">3</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 5
$ study_id &lt;dbl&gt; 600, 101, 102, 100, 106, 104, 105, 200, 107, 201, 108, 109, 3…
$ arm      &lt;chr&gt; "PartnerCHESS", "A-CHESS", "PartnerCHESS", "PartnerCHESS", "P…
$ time1    &lt;dbl&gt; 65.0, 100.0, 0.0, 13.6, 64.4, 100.0, 23.8, 100.0, 4.8, 46.6, …
$ time2    &lt;dbl&gt; 59.5, 100.0, 0.0, 1.4, 41.9, 0.0, 0.0, 100.0, 0.0, 50.0, 100.…
$ time3    &lt;dbl&gt; 42.0, 100.0, 0.0, 84.6, 94.4, 0.0, 0.0, 56.1, 0.0, 100.0, 100…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 5
   study_id arm          time1 time2 time3
      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1      600 PartnerCHESS  65    59.5  42  
 2      101 A-CHESS      100   100   100  
 3      102 PartnerCHESS   0     0     0  
 4      100 PartnerCHESS  13.6   1.4  84.6
 5      106 PartnerCHESS  64.4  41.9  94.4
 6      104 A-CHESS      100     0     0  
 7      105 PartnerCHESS  23.8   0     0  
 8      200 PartnerCHESS 100   100    56.1
 9      107 A-CHESS        4.8   0     0  
10      201 A-CHESS       46.6  50   100  
# ℹ 23 more rows</code></pre>
</div>
</div>
</section>
<section id="setting-contrast-matrices-for-factors" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="setting-contrast-matrices-for-factors"><span class="header-section-number">1.1.4</span> Setting contrast matrices for factors</h3>
<ul>
<li>see: https://marissabarlaz.github.io/portfolio/contrastcoding/</li>
<li>Default for unordered factors is treatment/dummy</li>
<li>We typically want centered orthogonal, and unit weighted. Helmert often good choice</li>
<li>Below, we demo how to set up contrast matrices by code</li>
<li>We will apply them later as needed</li>
<li>We make Helmert contrast matrices for 2 and 3 level factors here</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">helmert2 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"time2"</span>), <span class="fu">c</span>(<span class="st">"t2v1"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      t2v1
time1 -0.5
time2  0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">helmert3 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"time2"</span>, <span class="st">"time3"</span>), <span class="fu">c</span>(<span class="st">"t32v1"</span>, <span class="st">"t3v2"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           t32v1 t3v2
time1 -0.6666667  0.0
time2  0.3333333 -0.5
time3  0.3333333  0.5</code></pre>
</div>
</div>
</section>
</section>
<section id="explore-two-level-repeated-measures" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="explore-two-level-repeated-measures"><span class="header-section-number">1.2</span> Explore two level repeated measures</h2>
<ul>
<li>Use only time 1 and time 2 to demo two level repeated measures analyses</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d2_long <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 66
Columns: 4
$ study_id &lt;dbl&gt; 600, 600, 101, 101, 102, 102, 100, 100, 106, 106, 104, 104, 1…
$ arm      &lt;chr&gt; "PartnerCHESS", "PartnerCHESS", "A-CHESS", "A-CHESS", "Partne…
$ time     &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1…
$ hdd      &lt;dbl&gt; 65.0, 59.5, 100.0, 100.0, 0.0, 0.0, 13.6, 1.4, 64.4, 41.9, 10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>d2_wide <span class="ot">&lt;-</span> d_wide <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>time3) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 4
$ study_id &lt;dbl&gt; 600, 101, 102, 100, 106, 104, 105, 200, 107, 201, 108, 109, 3…
$ arm      &lt;chr&gt; "PartnerCHESS", "A-CHESS", "PartnerCHESS", "PartnerCHESS", "P…
$ time1    &lt;dbl&gt; 65.0, 100.0, 0.0, 13.6, 64.4, 100.0, 23.8, 100.0, 4.8, 46.6, …
$ time2    &lt;dbl&gt; 59.5, 100.0, 0.0, 1.4, 41.9, 0.0, 0.0, 100.0, 0.0, 50.0, 100.…</code></pre>
</div>
</div>
<section id="diff-score-approach" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="diff-score-approach"><span class="header-section-number">1.2.1</span> diff score approach</h3>
<p>This is the standard/traditional way to analyse this design and the benchmark for comparison</p>
<ul>
<li>Time effect tested using difference score for time2 - time1</li>
<li>Explicitly calculate that difference score in df</li>
<li>No assumption of sphericity is needed</li>
</ul>
<p>This is the test of the two level Time variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> time2 <span class="sc">-</span> time1) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(diff <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = diff ~ 1, data = mutate(d_wide, diff = time2 - time1))

Residuals:
    Min      1Q  Median      3Q     Max 
-89.018 -11.518   6.182  10.982  34.582 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  -10.982      3.984  -2.756  0.00958 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.89 on 32 degrees of freedom</code></pre>
</div>
</div>
<p>If you wanted to test the intercept in the between subject model you could do this. Not really useful here, but can be informative in some situations and also used when we have between subject variables in the design.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ave =</span> (time2 <span class="sc">+</span> time1) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(ave <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ave ~ 1, data = mutate(d_wide, ave = (time2 + time1)/2))

Residuals:
    Min      1Q  Median      3Q     Max 
-31.291 -28.741  -8.791  17.009  68.709 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   31.291      5.724   5.467 5.11e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.88 on 32 degrees of freedom</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-time-as-manually-coded-regressor" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="lmer-approach-with-time-as-manually-coded-regressor"><span class="header-section-number">1.2.2</span> lmer approach with time as manually coded regressor</h3>
<ul>
<li>This is first option using manually coded regressor for time (time_2v1, 0.5 vs.&nbsp;-0.5)</li>
<li>Use random intercept but no random slope for time when there are no <a href="https://psyteachr.github.io/stat-models-v1/linear-mixed-effects-models-with-one-random-factor.html">psuedoreplications</a> (i.e., where there is only one observation per cell). It is not possible to calculate both a by-subject random slope AND a by-subject random intercept for Time for each subject when there are only two observations for Time (i.e., this “two parameter” model would perfectly fit the two observations available for each subject!)</li>
<li>Use <code>Anova()</code> from car package on lmer object to get p-values</li>
</ul>
<p>First code the regressor for the time contrast</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>d2_long <span class="ot">&lt;-</span> d2_long <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_2v1 =</span> <span class="fu">if_else</span>(time <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 66
Columns: 5
$ study_id &lt;dbl&gt; 600, 600, 101, 101, 102, 102, 100, 100, 106, 106, 104, 104, 1…
$ arm      &lt;chr&gt; "PartnerCHESS", "PartnerCHESS", "A-CHESS", "A-CHESS", "Partne…
$ time     &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1…
$ hdd      &lt;dbl&gt; 65.0, 59.5, 100.0, 100.0, 0.0, 0.0, 13.6, 1.4, 64.4, 41.9, 10…
$ time_2v1 &lt;dbl&gt; -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>d2_long <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 66 × 5
   study_id arm           time   hdd time_2v1
      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1      600 PartnerCHESS     1  65       -0.5
 2      600 PartnerCHESS     2  59.5      0.5
 3      101 A-CHESS          1 100       -0.5
 4      101 A-CHESS          2 100        0.5
 5      102 PartnerCHESS     1   0       -0.5
 6      102 PartnerCHESS     2   0        0.5
 7      100 PartnerCHESS     1  13.6     -0.5
 8      100 PartnerCHESS     2   1.4      0.5
 9      106 PartnerCHESS     1  64.4     -0.5
10      106 PartnerCHESS     2  41.9      0.5
# ℹ 56 more rows</code></pre>
</div>
</div>
<p>Then do analysis.</p>
<ul>
<li>Do NOT use by subject random slope for time as noted above</li>
<li>Both parameter estimates (time and intercept) match above</li>
<li>p value for time and intercept match traditional diff score analysis</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>m2a <span class="ot">&lt;-</span> d2_long <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time_2v1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>m2a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ time_2v1 + (1 | study_id)
   Data: d2_long
REML criterion at convergence: 612.5259
Random effects:
 Groups   Name        Std.Dev.
 study_id (Intercept) 30.83   
 Residual             16.19   
Number of obs: 66, groups:  study_id, 33
Fixed Effects:
(Intercept)     time_2v1  
      31.29       -10.98  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>m2a <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 29.8846  1     32 5.109e-06 ***
time_2v1     7.5963  1     32  0.009575 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-time-as-factor" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="lmer-approach-with-time-as-factor"><span class="header-section-number">1.2.3</span> lmer approach with time as factor</h3>
<ul>
<li>Code time as a factor</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>d2_long <span class="ot">&lt;-</span> d2_long <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">factor</span>(time, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"time2"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Default contrasts for Time were treatment/dummy</li>
<li>We will apply centered (helmert) contrast matrix from earlier</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d2_long<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      time2
time1     0
time2     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d2_long<span class="sc">$</span>time) <span class="ot">&lt;-</span> helmert2</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d2_long<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      t2v1
time1 -0.5
time2  0.5</code></pre>
</div>
</div>
<ul>
<li>Do NOT use by subject random slope for time as described earlier</li>
<li>Paremeter estimates and p-values match</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>m2b <span class="ot">&lt;-</span> d2_long <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>m2b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ time + (1 | study_id)
   Data: d2_long
REML criterion at convergence: 612.5259
Random effects:
 Groups   Name        Std.Dev.
 study_id (Intercept) 30.83   
 Residual             16.19   
Number of obs: 66, groups:  study_id, 33
Fixed Effects:
(Intercept)     timet2v1  
      31.29       -10.98  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>m2b <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 29.8846  1     32 5.109e-06 ***
time         7.5963  1     32  0.009575 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-by-subject-random-effect-of-time" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="lmer-approach-with-by-subject-random-effect-of-time"><span class="header-section-number">1.2.4</span> lmer approach with by-subject random effect of time</h3>
<ul>
<li>NOPE!</li>
<li>! number of observations (=66) &lt;= number of random effects (=66) for term (1 + c_time | study_id); the random-effects parameters and the residual variance (or scale parameter) are probably unidentifiable</li>
<li>This WOULD be correct if we had psudeoreplications</li>
<li>This is because you cant estimate both a random intercept and a random slope for time with only two observations. The analogy would be fitting a two parameter model when N=2. Model would perfectly fit the data!</li>
<li>This is true regardless if you use time as factor or regressor. Those are equivalent analyses.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d2_long <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> study_id), <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You could try to force it</p>
<ul>
<li>ignore check of nobs vs nRe</li>
<li>In checkConv(attr(opt, “derivs”), opt<span class="math inline">\(par, ctrl = control\)</span>checkConv, :Model is nearly unidentifiable: large eigenvalue ratio - Rescale variables?</li>
<li>It does yield the same solution as earlier models but with the above warning</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>m2c <span class="ot">&lt;-</span> d2_long <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> study_id), <span class="at">data =</span> _,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">check.nobs.vs.nRE =</span> <span class="st">"ignore"</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>m2c</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>m2c <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="explore-three-level-repeated-measures" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="explore-three-level-repeated-measures"><span class="header-section-number">1.3</span> Explore three level repeated measures</h2>
<section id="using-afexaov_car" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="using-afexaov_car"><span class="header-section-number">1.3.1</span> Using <code>afex::aov_car</code></h3>
<p><code>aov_car()</code> from afex supports traditional anova designs in R. see also <code>aov()</code></p>
<ul>
<li>Remember that with 3 level repeated measures variables we now need to make an assumption of sphericity</li>
<li>This means that the variance of all the difference scores (e.g.&nbsp;time1 - time2, time1-time3, time2-time3) are equal</li>
<li>This assumption is similar to the assumption about equal variances across groups in between subject anovas. These assumptiosn allow each model to pool variances across groups (between subjects) or difference scores (within subject) to test the omnibus (in this case 2df) main effect. Remember that the error term for a 1 df within subject test is the variance of the difference. For 2df test, we need to pool two of these differences, which is only appropriate if those variances are the same.</li>
<li>Compound symetry is a stricter form of sphericity (var1 + var2 + covar12 = k for all combos of variates) but its often needed to have sphericity assumption met.</li>
<li>Machley test for sphericity exists but it is a poor test. Underpowered for small N, overpowered for large N.</li>
<li>If sphericity is violated, you can do df correction (GG or HF)</li>
</ul>
<p>First we need to set up 3-level time as a factor with helmert contrasts using the long format data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">factor</span>(time, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"time1"</span>, <span class="st">"time2"</span>, <span class="st">"time3"</span>)))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d_long<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      time2 time3
time1     0     0
time2     1     0
time3     0     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d_long<span class="sc">$</span>time) <span class="ot">&lt;-</span> helmert3</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(d_long<span class="sc">$</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           t32v1 t3v2
time1 -0.6666667  0.0
time2  0.3333333 -0.5
time3  0.3333333  0.5</code></pre>
</div>
</div>
<p><code>aov_car()</code> provides us with main effect of Time (2 df) with the pooled error term (64 ddf).</p>
<ul>
<li>As noted above, this is only appropriate if sphericity assumption is met.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>m_afex <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  afex<span class="sc">::</span><span class="fu">aov_car</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">Error</span>(study_id<span class="sc">/</span>time), <span class="at">data =</span> _)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_afex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Univariate Type III Repeated-Measures ANOVA Assuming Sphericity

            Sum Sq num Df Error SS den Df F value    Pr(&gt;F)    
(Intercept)  87588      1   104463     32 26.8308 1.178e-05 ***
time          2463      2    21227     64  3.7136   0.02979 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Mauchly Tests for Sphericity

     Test statistic  p-value
time        0.84158 0.069025


Greenhouse-Geisser and Huynh-Feldt Corrections
 for Departure from Sphericity

      GG eps Pr(&gt;F[GG])  
time 0.86325     0.0366 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

        HF eps Pr(&gt;F[HF])
time 0.9079611 0.03422039</code></pre>
</div>
</div>
<ul>
<li>Can get corrections to dfs if assumption is violated. Use <code>anova()</code> from stats package</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_afex, <span class="at">correction =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type 3 tests)

Response: hdd
     num Df den Df    MSE      F      ges  Pr(&gt;F)  
time      2     64 331.68 3.7136 0.019222 0.02979 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_afex, <span class="at">correction =</span> <span class="st">"GG"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type 3 tests)

Response: hdd
     num Df den Df    MSE      F      ges Pr(&gt;F)  
time 1.7265 55.248 384.22 3.7136 0.019222 0.0366 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_afex, <span class="at">correction =</span> <span class="st">"HF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type 3 tests)

Response: hdd
     num Df den Df   MSE      F      ges  Pr(&gt;F)  
time 1.8159  58.11 365.3 3.7136 0.019222 0.03422 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We can use <code>emmeans</code> package to get cell means and 1 df contrasts</p>
<ul>
<li>note the formula for the mean contrasts it NOT the helmert coefficients, but the actual algebraic formula for the contrasts we want.</li>
<li>This ALSO gives use tests of contrasts with SEPARATE, not POOLED error (note ddf = 32)</li>
<li>We want separate error because no assumption of sphericity needed</li>
<li>I have not seen pooled contrasts reported though they make sense to me as an option IF pooling is appropriate given sphericity</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>(means <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(m_afex, <span class="sc">~</span> time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> time  emmean   SE df lower.CL upper.CL
 time1   36.8 5.98 32     24.6     49.0
 time2   25.8 6.14 32     13.3     38.3
 time3   26.7 6.75 32     12.9     40.4

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(means, <span class="fu">list</span>(<span class="at">t32v1 =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">t3v2 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate   SE df t.ratio p.value
 t32v1     -10.556 4.23 32  -2.495  0.0180
 t3v2        0.852 4.04 32   0.211  0.8344</code></pre>
</div>
</div>
</section>
<section id="diff-score-approach-1" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="diff-score-approach-1"><span class="header-section-number">1.3.2</span> Diff score approach</h3>
<p>First here are the time contrast models.</p>
<ul>
<li>CRITICALLY, this tests contrasts with SEPARATE (rather than pooled) error. Note ddf = 32 for contrasts</li>
<li>This matches contrasts from <code>aov_car()</code></li>
<li>This method does not provide test of main effect of time (2 df)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_23v1 =</span> (time2 <span class="sc">+</span> time3) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">-</span> time1) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(diff_23v1 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = diff_23v1 ~ 1, data = mutate(d_wide, diff_23v1 = (time2 + 
    time3)/2 - time1))

Residuals:
    Min      1Q  Median      3Q     Max 
-89.444 -11.394   7.206  10.556  39.956 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  -10.556      4.231  -2.495    0.018 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 24.31 on 32 degrees of freedom</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_3v2 =</span> time3 <span class="sc">-</span> time2) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(diff_3v2 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = diff_3v2 ~ 1, data = mutate(d_wide, diff_3v2 = time3 - 
    time2))

Residuals:
    Min      1Q  Median      3Q     Max 
-44.752  -3.452  -0.852  -0.852  82.348 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   0.8515     4.0411   0.211    0.834

Residual standard error: 23.21 on 32 degrees of freedom</code></pre>
</div>
</div>
<p>And here is the main effects model for the intercept for time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>d_wide <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ave =</span> (time1 <span class="sc">+</span> time2 <span class="sc">+</span> time3) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(ave <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ave ~ 1, data = mutate(d_wide, ave = (time1 + time2 + 
    time3)/3))

Residuals:
   Min     1Q Median     3Q    Max 
-29.74 -28.04 -11.31  10.66  70.26 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   29.744      5.742    5.18 1.18e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 32.99 on 32 degrees of freedom</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-time-as-factor-1" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="lmer-approach-with-time-as-factor-1"><span class="header-section-number">1.3.3</span> lmer approach with time as factor</h3>
<ul>
<li>We do NOT include by subject random slope for time because there are no pseudoreplications. Once again, estimating 3 parameters (random intercept and two random slopes) will perfectly fit the 3 observations per subject</li>
<li>Gets 2df main effect but NOT contrasts</li>
<li>Matches main effect results from <code>aov_car()</code> when sphericity is assumed.</li>
<li>This makes some sense too. If you dont allow for random slopes, then all the subjects have the SAME difference scores for the two contrasts and therefore 0 variance. Thus the variance of both are the same and we are just left with variance in intercept and residual within subject.</li>
<li>This solution is not appropriate if sphericity is not met</li>
<li>And you would need to got to <code>aov_car()</code> or similar to test for sphericity and get corrections if needed. NOT A GOOD SOLUTION IMHO</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>m3a<span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>m3a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ time + (1 | study_id)
   Data: d_long
REML criterion at convergence: 913.2997
Random effects:
 Groups   Name        Std.Dev.
 study_id (Intercept) 31.27   
 Residual             18.21   
Number of obs: 99, groups:  study_id, 33
Fixed Effects:
(Intercept)    timet32v1     timet3v2  
    29.7444     -10.5561       0.8515  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>m3a <span class="sc">|&gt;</span> car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 26.8308  1     32 1.178e-05 ***
time         3.7136  2     64   0.02979 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-regressors-for-time" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="lmer-approach-with-regressors-for-time"><span class="header-section-number">1.3.4</span> lmer approach with regressors for time</h3>
<ul>
<li>Do NOT include by subject random slope for time because no pseudoreplications</li>
<li>Gets 1 df contrasts for time and parameter estimates match</li>
<li>BUT uses a pooled error to test contrasts. ddf = 64. So p-values do NOT match. Appropriate (better?) if sphericity holds but definitely not if it doesn’t!</li>
<li>Does not get main effect (2df) for time</li>
</ul>
<p>First, add regressors for helmert contrasts for three level time variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_32v1 =</span> <span class="fu">case_match</span>(time,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"time1"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">c</span>(<span class="st">"time2"</span>, <span class="st">"time3"</span>) <span class="sc">~</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_3v2 =</span> <span class="fu">case_match</span>(time, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"time1"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"time2"</span> <span class="sc">~</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"time3"</span> <span class="sc">~</span> .<span class="dv">5</span>))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>d_long <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 99 × 6
   study_id arm          time    hdd time_32v1 time_3v2
      &lt;dbl&gt; &lt;chr&gt;        &lt;fct&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1      600 PartnerCHESS time1  65      -0.667      0  
 2      600 PartnerCHESS time2  59.5     0.333     -0.5
 3      600 PartnerCHESS time3  42       0.333      0.5
 4      101 A-CHESS      time1 100      -0.667      0  
 5      101 A-CHESS      time2 100       0.333     -0.5
 6      101 A-CHESS      time3 100       0.333      0.5
 7      102 PartnerCHESS time1   0      -0.667      0  
 8      102 PartnerCHESS time2   0       0.333     -0.5
 9      102 PartnerCHESS time3   0       0.333      0.5
10      100 PartnerCHESS time1  13.6    -0.667      0  
# ℹ 89 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>m3b <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  lme4<span class="sc">::</span><span class="fu">lmer</span>(hdd <span class="sc">~</span> time_32v1 <span class="sc">+</span> time_3v2 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>m3b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ time_32v1 + time_3v2 + (1 | study_id)
   Data: d_long
REML criterion at convergence: 913.2997
Random effects:
 Groups   Name        Std.Dev.
 study_id (Intercept) 31.27   
 Residual             18.21   
Number of obs: 99, groups:  study_id, 33
Fixed Effects:
(Intercept)    time_32v1     time_3v2  
    29.7444     -10.5561       0.8515  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>m3b <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 26.8308  1     32 1.178e-05 ***
time_32v1    7.3911  1     64  0.008426 ** 
time_3v2     0.0361  1     64  0.849971    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="lmer-approach-with-regressors-for-time-and-separate-error-terms" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="lmer-approach-with-regressors-for-time-and-separate-error-terms"><span class="header-section-number">1.3.5</span> lmer approach with regressors for time AND separate error terms</h3>
<p>I don’t show code for this but we could aggregate down to long format but just the two levels (with two rows per subject) of time separately for each time contrast and then we would be back to the 2 level lmer approach to time from above. This would be fine but its cumbersome so I don’t think this is worth it.</p>
</section>
<section id="with-random-effect-for-time" class="level3" data-number="1.3.6">
<h3 data-number="1.3.6" class="anchored" data-anchor-id="with-random-effect-for-time"><span class="header-section-number">1.3.6</span> With random effect for time</h3>
<ul>
<li>NOPE</li>
<li>! number of observations (=99) &lt;= number of random effects (=99) for term (1 + time | study_id); the random-effects parameters and the residual variance (or scale parameter) are probably unidentifiable</li>
<li>Again, no pseudoreplications so no by-subject random effect for time can be estimated</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>m3c <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And if we force it, we get warnings… * 1: In checkConv(attr(opt, “derivs”), opt$par, ctrl = control<span class="math inline">\(checkConv, :  unable to evaluate scaled gradient * In checkConv(attr(opt, "derivs"), opt\)</span>par, ctrl = control$checkConv, : Model failed to converge: degenerate Hessian with 1 negative eigenvalues</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>m3c <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> study_id), <span class="at">data =</span> _,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">check.nobs.vs.nRE =</span> <span class="st">"ignore"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">optCtrl =</span> <span class="fu">list</span>(<span class="at">maxfun =</span> <span class="dv">1000000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lmer-with-time-as-continuous-variable" class="level3" data-number="1.3.7">
<h3 data-number="1.3.7" class="anchored" data-anchor-id="lmer-with-time-as-continuous-variable"><span class="header-section-number">1.3.7</span> lmer with time as continuous variable</h3>
<p>Now we can specify by subject random slope for time</p>
<p>And this model doesn’t make sphericity assumption because it allows for the slopes to vary by subject</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_time =</span> <span class="fu">as.numeric</span>(time) <span class="sc">*</span> <span class="dv">2</span>,  <span class="co"># for 2, 4, and 6 months</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_time =</span> r_time <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 99
Columns: 8
$ study_id  &lt;dbl&gt; 600, 600, 600, 101, 101, 101, 102, 102, 102, 100, 100, 100, …
$ arm       &lt;chr&gt; "PartnerCHESS", "PartnerCHESS", "PartnerCHESS", "A-CHESS", "…
$ time      &lt;fct&gt; time1, time2, time3, time1, time2, time3, time1, time2, time…
$ hdd       &lt;dbl&gt; 65.0, 59.5, 42.0, 100.0, 100.0, 100.0, 0.0, 0.0, 0.0, 13.6, …
$ time_32v1 &lt;dbl&gt; -0.6666667, 0.3333333, 0.3333333, -0.6666667, 0.3333333, 0.3…
$ time_3v2  &lt;dbl&gt; 0.0, -0.5, 0.5, 0.0, -0.5, 0.5, 0.0, -0.5, 0.5, 0.0, -0.5, 0…
$ r_time    &lt;dbl&gt; 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, …
$ c_time    &lt;dbl&gt; 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>m_raw <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> r_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> r_time <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>m_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ r_time + (1 + r_time | study_id)
   Data: d_long
REML criterion at convergence: 917.5282
Random effects:
 Groups   Name        Std.Dev. Corr 
 study_id (Intercept) 34.504        
          r_time       5.552   -0.44
 Residual             14.732        
Number of obs: 99, groups:  study_id, 33
Fixed Effects:
(Intercept)       r_time  
     39.875       -2.533  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>m_raw <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 30.9206  1     32 3.887e-06 ***
r_time       3.6522  1     32   0.06499 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Centering matters - here only for intercept but more impacts with higher order models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>m_center <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> c_time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> c_time <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>m_center</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ c_time + (1 + c_time | study_id)
   Data: d_long
REML criterion at convergence: 917.5282
Random effects:
 Groups   Name        Std.Dev. Corr 
 study_id (Intercept) 31.303        
          c_time       5.552   -0.13
 Residual             14.732        
Number of obs: 99, groups:  study_id, 33
Fixed Effects:
(Intercept)       c_time  
     34.810       -2.533  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>m_center <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                  F Df Df.res    Pr(&gt;F)    
(Intercept) 34.4489  1     32 1.585e-06 ***
c_time       3.6523  1     32   0.06498 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>To fit poly model, you probably want to use centered time because linear effect will be at time = 0 (time mid point). Or chose another sensible 0 point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>d_long <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">c_time2 =</span> c_time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 99
Columns: 9
$ study_id  &lt;dbl&gt; 600, 600, 600, 101, 101, 101, 102, 102, 102, 100, 100, 100, …
$ arm       &lt;chr&gt; "PartnerCHESS", "PartnerCHESS", "PartnerCHESS", "A-CHESS", "…
$ time      &lt;fct&gt; time1, time2, time3, time1, time2, time3, time1, time2, time…
$ hdd       &lt;dbl&gt; 65.0, 59.5, 42.0, 100.0, 100.0, 100.0, 0.0, 0.0, 0.0, 13.6, …
$ time_32v1 &lt;dbl&gt; -0.6666667, 0.3333333, 0.3333333, -0.6666667, 0.3333333, 0.3…
$ time_3v2  &lt;dbl&gt; 0.0, -0.5, 0.5, 0.0, -0.5, 0.5, 0.0, -0.5, 0.5, 0.0, -0.5, 0…
$ r_time    &lt;dbl&gt; 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, 6, 2, 4, …
$ c_time    &lt;dbl&gt; 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, 4, 0, 2, …
$ c_time2   &lt;dbl&gt; 0, 4, 16, 0, 4, 16, 0, 4, 16, 0, 4, 16, 0, 4, 16, 0, 4, 16, …</code></pre>
</div>
</div>
<p>But you can’t fit poly model with quadratic effect with random slopes because, once again cant estimate intercept and both random slopes without more observations per subject</p>
<p>Error: number of observations (=99) &lt;= number of random effects (=99) for term (1 + c_time + c_time2 | study_id); the random-effects parameters and the residual variance (or scale parameter) are probably unidentifiable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>m_poly <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> c_time <span class="sc">+</span> c_time2 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> c_time <span class="sc">+</span> c_time2 <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But you CAN return to not estimating by subject random slopes. I suspect that this has the same sphericity issue though! Not sure about that but it seems to make sense that you are putting an unrealisitc (or at least unevaluated) assumption on the strucure of the error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>m_poly <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(hdd <span class="sc">~</span> c_time <span class="sc">+</span> c_time2 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> study_id), <span class="at">data =</span> _)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>m_poly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: hdd ~ c_time + c_time2 + (1 | study_id)
   Data: d_long
REML criterion at convergence: 918.8449
Random effects:
 Groups   Name        Std.Dev.
 study_id (Intercept) 31.27   
 Residual             18.21   
Number of obs: 99, groups:  study_id, 33
Fixed Effects:
(Intercept)       c_time      c_time2  
     36.782       -8.449        1.479  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>m_poly <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">Anova</span>(<span class="at">type =</span> <span class="dv">3</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald F tests with Kenward-Roger df)

Response: hdd
                 F Df Df.res    Pr(&gt;F)    
(Intercept) 34.099  1 45.389 5.255e-07 ***
c_time       4.371  1 64.000   0.04053 *  
c_time2      2.322  1 64.000   0.13248    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="predicted-values-and-figures" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Predicted values and figures</h1>
<p>This is a demo of predicted values and plot for the model with time as a continuous variable. I use the linear model of time and raw time scores. For the plot, centering doesn’t matter. Its all the same model space and it easier to understand in raw time units. Alternatively, we could use centered time and then change the values on the axis that displays time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can add the means from raw data to plot and then superimpose the fitted model</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">&lt;-</span> d_long <span class="sc">|&gt;</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(r_time) <span class="sc">|&gt;</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">hdd_mean =</span> <span class="fu">mean</span>(hdd), <span class="at">hdd_se =</span> <span class="fu">sd</span>(hdd)<span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(hdd)))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">&lt;-</span> d_plot <span class="sc">|&gt;</span> </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hdd_pred =</span> <span class="fu">predict</span>(m_raw, <span class="at">newdata =</span> d_plot, <span class="at">re.form =</span> <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 4
$ r_time   &lt;dbl&gt; 2, 4, 6
$ hdd_mean &lt;dbl&gt; 36.78182, 25.80000, 26.65152
$ hdd_se   &lt;dbl&gt; 5.979868, 6.140520, 6.749849
$ hdd_pred &lt;dbl&gt; 34.80960, 29.74444, 24.67929</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>d_plot <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_time)) <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> hdd_mean <span class="sc">-</span> hdd_se, <span class="at">ymax =</span> hdd_mean <span class="sc">+</span> hdd_se),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> hdd_mean)) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> hdd_pred), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repeated_measures_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Welcome</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./bayes.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bayesian Analyses with rstanarm</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>